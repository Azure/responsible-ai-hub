"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[684],{8908:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>a,frontMatter:()=>r,metadata:()=>l,toc:()=>h});var s=n(5893),o=n(1151);const r={id:"pf-chatbot-with-your-data-lab5'",title:"Lab# 5: Chatbot to use your data",sidebar_position:4,slug:"/chatbot-with-your-data"},i=void 0,l={id:"azure-prompt-flow/lab5-chatbot-with-your-data/pf-chatbot-with-your-data-lab5'",title:"Lab# 5: Chatbot to use your data",description:"In the precise exercise you create a vector index and train to search for your vector embeddings.  In the exercise, you\u2019ll be expanding the Chat pipeline logic to take the user question and convert to numeric embeddings.  Then we\u2019ll use the numeric embedding to search the numeric vector.  Next, we\u2019ll use the prompt to set rules with restrictions and how to display the data to the user.",source:"@site/docs/azure-prompt-flow/lab5-chatbot-with-your-data/lab5-chatbot-with-your-data.md",sourceDirName:"azure-prompt-flow/lab5-chatbot-with-your-data",slug:"/chatbot-with-your-data",permalink:"/docs/chatbot-with-your-data",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{id:"pf-chatbot-with-your-data-lab5'",title:"Lab# 5: Chatbot to use your data",sidebar_position:4,slug:"/chatbot-with-your-data"},sidebar:"promptFlowSidebar",previous:{title:"Lab# 4: bring your own data",permalink:"/docs/bring-your-data"},next:{title:"Lab# 6: Run custom chatbot",permalink:"/docs/run-custom-chatbot"}},c={},h=[];function d(e){const t={code:"code",em:"em",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.p,{children:"In the precise exercise you create a vector index and train to search for your vector embeddings.  In the exercise, you\u2019ll be expanding the Chat pipeline logic to take the user question and convert to numeric embeddings.  Then we\u2019ll use the numeric embedding to search the numeric vector.  Next, we\u2019ll use the prompt to set rules with restrictions and how to display the data to the user."}),"\n",(0,s.jsx)(t.p,{children:"We'll be using the following tools:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Embedding"}),": converts text to number tokens.  Store to token in vector arrays based on then relation to each other."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Vector index lookup"}),": Takes user input question and queries the vector index with the closest answers to the question."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Prompt"}),": enters user to add rules on the response show be sent to user"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"LLM"}),": provides the LLM prompt or LLM model response to user"]}),"\n"]}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"Open Prompt Flow service for Visual Studio code, by clicking the icon."}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{src:n(9834).Z+"",width:"847",height:"287"})}),"\n",(0,s.jsxs)(t.ol,{start:"2",children:["\n",(0,s.jsxs)(t.li,{children:["On the ",(0,s.jsx)(t.strong,{children:"TOOLS"})," toolbar, select the ",(0,s.jsx)(t.strong,{children:"Embedding"})," tool by clicking on plus icon ",(0,s.jsx)(t.strong,{children:"+"}),"."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{src:n(6398).Z+"",width:"358",height:"427"})}),"\n",(0,s.jsxs)(t.ol,{start:"3",children:["\n",(0,s.jsxs)(t.li,{children:["Enter ",(0,s.jsx)(t.strong,{children:"Name"})," for the node (e.g. embed_question) in the pop-up entry on top of the page. Then press ",(0,s.jsx)(t.strong,{children:"Enter"}),".  This will generate a new Embedding section at the bottom of the flow."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{src:n(8235).Z+"",width:"945",height:"406"})}),"\n",(0,s.jsxs)(t.ol,{start:"4",children:["\n",(0,s.jsxs)(t.li,{children:["Select the ",(0,s.jsx)(t.strong,{children:"AzureOpenAIconnection"})," name you created earlier."]}),"\n",(0,s.jsxs)(t.li,{children:["Select ",(0,s.jsx)(t.strong,{children:"Text-embedding-ada-002"})," deployment name you created earlier"]}),"\n",(0,s.jsxs)(t.li,{children:["For ",(0,s.jsx)(t.strong,{children:"Input"}),", select ",(0,s.jsx)(t.code,{children:"*${inputs.question}*"}),".  This should create a node under the input node."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{src:n(7778).Z+"",width:"1255",height:"422"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Vector Index Lookup*"}),"\n"]}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["On the ",(0,s.jsx)(t.strong,{children:"TOOLS"})," toolbar, select the ",(0,s.jsx)(t.strong,{children:"Vector Index Lookup"})," tool by clicking on plus icon ",(0,s.jsx)(t.strong,{children:"+"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:["Enter ",(0,s.jsx)(t.strong,{children:"Name"})," for the node (e.g. search_vector_index).  This will generate a new ",(0,s.jsx)(t.strong,{children:"Vector Index Lookup"})," section at the bottom of the flow."]}),"\n",(0,s.jsxs)(t.li,{children:["For ",(0,s.jsx)(t.strong,{children:"Path"}),", copy and paste the Datastore URI you retrieve earlier for the vector index."]}),"\n",(0,s.jsxs)(t.li,{children:["Select the embedding output as the ",(0,s.jsx)(t.strong,{children:"query"})," field (e.g. ",(0,s.jsx)(t.code,{children:"*${embed_question.output}*"}),")."]}),"\n",(0,s.jsxs)(t.li,{children:["Leave default value for ",(0,s.jsx)(t.strong,{children:"top_k"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"NOTE"}),": Feel free move the nodes around to make it easier to view the flow."]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{src:n(474).Z+"",width:"1280",height:"327"})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.em,{children:"Construct Prompt"})}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["On the ",(0,s.jsx)(t.strong,{children:"TOOLS"})," toolbar, select the ",(0,s.jsx)(t.strong,{children:"Prompt"})," tool by clicking on plus icon ",(0,s.jsx)(t.strong,{children:"+"}),".  This will generate a new Prompt section at the bottom of the flow."]}),"\n",(0,s.jsxs)(t.li,{children:["Enter a ",(0,s.jsx)(t.strong,{children:"Name"})," for the node (e.g. generate_prompt).  This will generate a new Prompt section at the bottom of the flow."]}),"\n",(0,s.jsxs)(t.li,{children:["Click on the ",(0,s.jsx)(t.strong,{children:".jinja2"})," link to open the prompt editor.  This will open a new tab in the editor."]}),"\n",(0,s.jsx)(t.li,{children:"Delete all the text in the file.  Then, copy the following text in the Prompt textbox:"}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"system:\nYou are an AI system designed to answer questions. When presented with a scenario, you must reply with accuracy to inquirers' inquiries.  If there is ever a situation where you are unsure of the potential answers, simply respond with \"I don't know.  \n\ncontext: {{contexts}}\n\n{% for item in chat_history %}\nuser:\n{{item.inputs.question}}\nassistant:\n{{item.outputs.answer}}\n{% endfor %}\n\nuser:\n{{question}}\n"})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{src:n(8020).Z+"",width:"1284",height:"380"})}),"\n",(0,s.jsxs)(t.ol,{start:"5",children:["\n",(0,s.jsx)(t.li,{children:"Close the .jinja2 prompt editor tab.  Then return to the flow.dag.yaml tab."}),"\n",(0,s.jsx)(t.li,{children:"In your prompt section of the flow, you would see the prompt flow automatically generated the input fields from the placeholder fields in your .jinja2 file."}),"\n",(0,s.jsxs)(t.li,{children:["Select ",(0,s.jsx)(t.code,{children:"${inputs.question}"})," for the ",(0,s.jsx)(t.strong,{children:"question"})," field."]}),"\n",(0,s.jsxs)(t.li,{children:["For ",(0,s.jsx)(t.strong,{children:"contexts"}),", select ",(0,s.jsx)(t.code,{children:"${Search_Vector_Index.output}"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:["Select the ",(0,s.jsx)(t.code,{children:"${inputs.chat_history}"})," for ",(0,s.jsx)(t.strong,{children:"chat_history"})]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{src:n(8402).Z+"",width:"1375",height:"399"})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.em,{children:"chat"})}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["Click on the ",(0,s.jsx)(t.strong,{children:"chat"})," node and drag it below the ",(0,s.jsx)(t.strong,{children:"generate_prompt"})," node."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{src:n(242).Z+"",width:"350",height:"424"})}),"\n",(0,s.jsxs)(t.ol,{start:"2",children:["\n",(0,s.jsxs)(t.li,{children:["Click on the ",(0,s.jsx)(t.strong,{children:"chat"})," to scroll up to the ",(0,s.jsx)(t.em,{children:"chat"})," section."]}),"\n",(0,s.jsxs)(t.li,{children:["Click on the ",(0,s.jsx)(t.strong,{children:".jinja2"})," link for the chat to open the prompt editor.  This will open a new tab in the editor."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{src:n(1410).Z+"",width:"669",height:"347"})}),"\n",(0,s.jsxs)(t.ol,{start:"4",children:["\n",(0,s.jsx)(t.li,{children:"Delete all the text in the file.  Then, copy and paste the following text in the Prompt textbox.  This specifies the output to display to the user:"}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"{{prompt_response}}\n"})}),"\n",(0,s.jsxs)(t.ol,{start:"5",children:["\n",(0,s.jsxs)(t.li,{children:["Close the ",(0,s.jsx)(t.strong,{children:".jinja2"})," prompt editor tab.  Then return to the ",(0,s.jsx)(t.strong,{children:"flow.dag.yaml"})," tab."]}),"\n",(0,s.jsxs)(t.li,{children:["In your chat section of the flow, you would see that prompt flow automatically generated a ",(0,s.jsx)(t.strong,{children:"prompt_response"})," input fields from the placeholder fields in your .jinja2 file."]}),"\n",(0,s.jsxs)(t.li,{children:["In the ",(0,s.jsx)(t.em,{children:"prompt_response"})," value, select ",(0,s.jsx)(t.code,{children:"${generate_prompt.output}"}),"."]}),"\n"]})]})}function a(e={}){const{wrapper:t}={...(0,o.a)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8235:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/add-embedding-node-0efbf0e16d5b7aecbd917dbb955d6616.png"},1410:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/chat-jinja2-e12c302331fc29bfd646c7b0eb1c54e0.png"},242:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/chat-node-a559006b1f5cfc83dbb2123788e5a588.png"},8020:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/construct-prompt-2291b048c217c92e7eb6f6e70ba458fc.png"},7778:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/embed-section-501e2e6ad73e06ca25adc198f0938cd5.png"},6398:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/flow-tools-480fe56a56c497cfde43713c215a0380.png"},8402:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/prompt-inputs-81c8855deaaa1bac67e7889b32600803.png"},9834:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/promptflow-icon-5bc755d099b85202709ae9aabb71b857.png"},474:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/search-vector-88b150e9f60372e4d3085f7752d00b11.png"},1151:(e,t,n)=>{n.d(t,{Z:()=>l,a:()=>i});var s=n(7294);const o={},r=s.createContext(o);function i(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);