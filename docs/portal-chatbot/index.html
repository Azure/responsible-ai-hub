<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-azure-prompt-flow/portal/lab1-portal chatbot/pf-portal-chatbot-lab1'" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">Lab# 1: portal chatbot | Responsible AI Developer Hub</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://azure.github.io/responsible-ai-hub/img/responsible-ai-card.jpg"><meta data-rh="true" name="twitter:image" content="https://azure.github.io/responsible-ai-hub/img/responsible-ai-card.jpg"><meta data-rh="true" property="og:url" content="https://azure.github.io/responsible-ai-hub/docs/portal-chatbot"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Lab# 1: portal chatbot | Responsible AI Developer Hub"><meta data-rh="true" name="description" content="Prompt engineering is a tedious process that involves a lot tasks and components.  Developments have next determine what the input or prompts are going to be and what the actions we want in return.  In order to achieve, there are a lot of parts.  For instance, the prompts are responses need to be tokenize.  Next, depending on that the action that will be the output, we need to identify where that information is coming from.  Is the information coming from an API, or an LLM model?  When data is returned, does it need preprocessing?  How is the best response identify?"><meta data-rh="true" property="og:description" content="Prompt engineering is a tedious process that involves a lot tasks and components.  Developments have next determine what the input or prompts are going to be and what the actions we want in return.  In order to achieve, there are a lot of parts.  For instance, the prompts are responses need to be tokenize.  Next, depending on that the action that will be the output, we need to identify where that information is coming from.  Is the information coming from an API, or an LLM model?  When data is returned, does it need preprocessing?  How is the best response identify?"><link data-rh="true" rel="icon" href="/responsible-ai-hub/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://azure.github.io/responsible-ai-hub/docs/portal-chatbot"><link data-rh="true" rel="alternate" href="https://azure.github.io/responsible-ai-hub/docs/portal-chatbot" hreflang="en"><link data-rh="true" rel="alternate" href="https://azure.github.io/responsible-ai-hub/docs/portal-chatbot" hreflang="x-default"><script>!function(t,e,n,c,a,s,r){t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},(s=e.createElement(c)).async=1,s.src="https://www.clarity.ms/tag/k0s1hzc31a",(r=e.getElementsByTagName(c)[0]).parentNode.insertBefore(s,r)}(window,document,"clarity","script")</script><link rel="stylesheet" href="/responsible-ai-hub/assets/css/styles.b2f9d7f8.css">
<script src="/responsible-ai-hub/assets/js/runtime~main.4928d54d.js" defer="defer"></script>
<script src="/responsible-ai-hub/assets/js/main.994856ed.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#e3a359;color:#000000" role="banner"><div class="content_knG7 announcementBarContent_xLdY"><a href="https://github.com/azure/responsible-ai-hub"><b> Give us a Star on GitHub</b></a> ▪️ <a href="https://aka.ms/rai-hub/collection"><b>Browse Our Learn Collection</b></a> </div></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/responsible-ai-hub/"><div class="navbar__logo"><img src="/responsible-ai-hub/img/logo.png" alt="RAI Dashboard Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/responsible-ai-hub/img/logo.png" alt="RAI Dashboard Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Responsible AI</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Start Here</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/responsible-ai-hub/no-azure">No Azure Account</a></li><li><a class="dropdown__link" href="/responsible-ai-hub/student-azure">Student Azure Account</a></li><li><a class="dropdown__link" href="/responsible-ai-hub/pro-azure">Pro Azure Account</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Workshops</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/responsible-ai-hub/docs/rai-dashboard-ms-learn">1. Responsible AI Dashboard</a></li><li><a class="dropdown__link" href="/responsible-ai-hub/docs/content-safety-overview">2. Azure Content Safety for OpenAI</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/responsible-ai-hub/docs/prompt-flow-overview">3. Azure Prompt Flow</a></li></ul></div><a class="navbar__item navbar__link" href="/responsible-ai-hub/docs/badges">Earn Badges</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Collections</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/responsible-ai-hub/collections">1. Responsible AI Dashboard</a></li></ul></div><a href="https://github.com/azure/responsible-ai-hub" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/responsible-ai-hub/docs/prompt-flow-overview">Prompt Flow Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/responsible-ai-hub/docs/portal-chatbot">portal</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/responsible-ai-hub/docs/portal-chatbot">Lab 1 - Portal Chatbot</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/responsible-ai-hub/docs/portal-chatbot">Lab# 1: portal chatbot</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/responsible-ai-hub/docs/evaluate-chatbot">Lab 2 - Evaluate Chatbot</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/responsible-ai-hub/docs/build-workshop-enviroment">vscode</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/responsible-ai-hub/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">portal</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Lab 1 - Portal Chatbot</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Lab# 1: portal chatbot</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Lab# 1: portal chatbot</h1></header><p>Prompt engineering is a tedious process that involves a lot tasks and components.  Developments have next determine what the input or prompts are going to be and what the actions we want in return.  In order to achieve, there are a lot of parts.  For instance, the prompts are responses need to be tokenize.  Next, depending on that the action that will be the output, we need to identify where that information is coming from.  Is the information coming from an API, or an LLM model?  When data is returned, does it need preprocessing?  How is the best response identify?</p>
<p><img loading="lazy" src="/responsible-ai-hub/assets/images/vector-token-embed-0756002b21b7c6e86c0758d40a6ff5aa.png" width="2077" height="502" class="img_ev3q"></p>
<p>That’s where Azure Prompt Flow, is valuable if providing a user-friendly logical flow to structure the different tasks involves and their dependencies.  To understand how to utilize Prompt Flow to expedite process of using an LLM that takes input and generates.  We are going to use a dental clinic’s virtual chat agent takes input from users and provides an answer.  Since using OpenAI or any other LLM model is not going to know specific information about our Contoso dental client, we are going to use data for our clinic.</p>
<p><img loading="lazy" src="/responsible-ai-hub/assets/images/rag-pattern-1b2e83defdb1354c2068eb4f0a516f56.png" width="806" height="102" class="img_ev3q"></p>
<p>After the workshop, you learn how to:</p>
<ul>
<li>Chat flow that takes input and produces output while keeping a dialog history.</li>
<li>Take custom data (in csv file) and convert the data into tokenized embeddings with vector indexes.</li>
<li>Use the LLM tool to create prompts and the response</li>
<li>Use the embedding tool to the trained embeddings model to search the vector index</li>
<li>Use the Python tool to create custom functions to preprocess data or call an API</li>
<li>Use the Prompt tool to format the output response.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites:<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites:" title="Direct link to Prerequisites:">​</a></h2>
<ul>
<li>Login or Signup for a Free Azure account</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="launch-github-code-spaces-to-create-azure-resources">Launch GitHub code spaces to create Azure resources<a href="#launch-github-code-spaces-to-create-azure-resources" class="hash-link" aria-label="Direct link to Launch GitHub code spaces to create Azure resources" title="Direct link to Launch GitHub code spaces to create Azure resources">​</a></h2>
<ul>
<li>Create Azure OpenAI</li>
<li>Add deployment to OpenAI instance</li>
<li>Create Azure ML workspace</li>
<li>Create Azure ML compute</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="enable-prompt-flow-and-access-connection-data">Enable Prompt Flow and Access Connection data<a href="#enable-prompt-flow-and-access-connection-data" class="hash-link" aria-label="Direct link to Enable Prompt Flow and Access Connection data" title="Direct link to Enable Prompt Flow and Access Connection data">​</a></h2>
<p>Before we can do this, we’ll need to retrieve details on the Azure OpenAI API instance provisioned in your Azure account.</p>
<p>Azure OpenAI</p>
<ol>
<li>Open the Azure portal, in the search box type “Azure OpenAI”, then press enter to search your resource.</li>
<li>Click on Azure OpenAI.  You should see your OpenAI instance list on the Azure AI Services page for Azure OpenAI</li>
</ol>
<p><img loading="lazy" src="/responsible-ai-hub/assets/images/azure-open-ai-e77e3b7fbc572558922e48ec4ec150a3.png" width="1038" height="273" class="img_ev3q"></p>
<ol start="3">
<li>Click on your OpenAI instance.</li>
<li>Under Resource Management, select the Keys and Endpoint on the left-hand side of the navigation bar</li>
<li>Copy <strong>Key 1</strong> and the <strong>Language APIs URL</strong>.  Store both values in a clipboard for later use</li>
</ol>
<p><img loading="lazy" src="/responsible-ai-hub/assets/images/azure-open-ai-e77e3b7fbc572558922e48ec4ec150a3.png" width="1038" height="273" class="img_ev3q"></p>
<ol start="6">
<li>Click on Overview on the left-hand side of the navigation bar.</li>
<li>On the Overview page, click on the Explore button</li>
<li>Click on Deployments on the left side of the navigation</li>
<li>Copy both the deployment name for the gpt-35-turbo model and text-embedding-ada-002</li>
</ol>
<p><img loading="lazy" src="/responsible-ai-hub/assets/images/openai-deployment-52aaefcacc9aa044c3ab2a680dcf7c82.png" width="1066" height="395" class="img_ev3q"></p>
<ol start="11">
<li>Close the browse tab for the Azure OpenAI Studio</li>
</ol>
<p><em>Azure Content Safety</em></p>
<ol>
<li>Open the browser tab for the Azure portal, and in the search box type “Content Safety”, then press enter to search your resource.</li>
<li>Select Content Safety.  You should see your Content Safety instance list on the Azure AI Services page for Content Safety</li>
</ol>
<p><img loading="lazy" src="/responsible-ai-hub/assets/images/content-safety-3a4ec8910a7ea375da345f0958d6a6f3.png" width="975" height="328" class="img_ev3q"></p>
<ol start="3">
<li>Click on your content safety instance.  Copy the name to be  used later</li>
<li>Under Resource Management, select the Keys and Endpoint on the left-hand side of the navigation bar</li>
<li>Copy Key 1 and the Endpoint URL.  Store both values in a clipboard for later use</li>
</ol>
<p><img loading="lazy" src="/responsible-ai-hub/assets/images/cs-key-endpt-c8d18d336f4798389c7b2677c5c3f5f4.png" width="975" height="493" class="img_ev3q"></p>
<p><em>Enable Prompt Flow</em></p>
<ol>
<li>
<p>Open <a href="https://ml.azure.com/" target="_blank" rel="noopener noreferrer">Azure ML studio</a>, and click on the bullhorn icon on the upper right corner of the page.</p>
</li>
<li>
<p>Locate <strong>Build AI solutions with Prompt Flow</strong>, switch it to Enabled the feature.</p>
</li>
<li>
<p>Close the features blade.</p>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="add-flow-connections">Add Flow connections<a href="#add-flow-connections" class="hash-link" aria-label="Direct link to Add Flow connections" title="Direct link to Add Flow connections">​</a></h2>
<p>As you work on creating Flows, it may have dependencies, services or external resources that you would need to connect to; such as OpenAI, Content Safety AI or your custom LLM models.  It enables users to add and manage connection to these resources as well as a their connection secrets.  Once a resource is connected, your Flow nodes have access to the resources metadata (e.g. name, api key, api_endpoint, or type).  In this workshop, we’ll be using the Azure OpenAI API and Azure Content Safety.</p>
<p>First, we’ll add the connection for Azure OpenAI API.</p>
<ol>
<li>Open the <a href="https://ml.azure.com/" target="_blank" rel="noopener noreferrer">Azure ML studio</a>,  and select <strong>Prompt Flow</strong> on the left-hand side of the navigation bar</li>
<li>Click on the <strong>Connections</strong> tab on the Prompt Flow page</li>
<li>Click on the <strong>Create</strong> button, then select <strong>Azure OpenAI</strong> option in the drop-down menu</li>
<li>Enter a <strong>Name</strong></li>
<li>The Azure OpenAI option should be selected for <strong>Provider</strong>.</li>
<li>Select your subscription under <strong>Subscription id</strong>.</li>
<li>Select your OpenAI instance name under <strong>Azure OpenAI Account Names</strong> drop-down menu.</li>
<li>Paste the Key 1 value for Azure OpenAI you copied earlier in the <strong>API key</strong> textbox.</li>
<li>Paste the Language API URL you copied earlier in the <strong>API base</strong> textbox.</li>
<li>The <strong>API type</strong> should be set to the default value (e.g. azure)</li>
<li>The <strong>API version</strong> should be set to the default value (e.g. 2023-07-01-preview)</li>
<li>Click <strong>Save</strong></li>
</ol>
<p>Next, we’ll add the connection for Content Safety.</p>
<ol>
<li>Click on the <strong>Create</strong> button, then select <strong>Azure Content Safety</strong> option in the drop-down menu</li>
<li>Enter a <strong>Name</strong></li>
<li>The <strong>Provider</strong> should be set to Azure content safety</li>
<li>Paste the Key 1 value for content safety you copied earlier in the <strong>API key</strong> textbox.</li>
<li>Paste the Endpoint URL you copied earlier in the <strong>Endpoint</strong> textbox.</li>
<li>The API version should be set to the default value (e.g. <em>2023-04-30-preview</em>)</li>
<li>The <strong>API type</strong> should be set to the default value (e.g. <em>Content Safety</em>)</li>
<li>Click <strong>Save</strong></li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-runtime">Create a Runtime<a href="#create-a-runtime" class="hash-link" aria-label="Direct link to Create a Runtime" title="Direct link to Create a Runtime">​</a></h2>
<p>To run the Prompt Flow nodes, you need to create a Runtime.  Runtime serve as the compute with a docker environment for executing the flows.  The Compute instance are the VMs and the environment are create from a docker image that contains the Python packages and dependencies need to run the Flow.  When creating a runtime, you have the option of choosing a default curated environment; or you can create your own custom environment.</p>
<p>To create runtime environment, complete the following steps:</p>
<ol>
<li>
<p>Click on the <strong>Runtime</strong> tab; than click <strong>Create</strong> button</p>
</li>
<li>
<p>Enter a <strong>Runtime name</strong></p>
</li>
<li>
<p>Select on existing compute under the <strong>Select Azure ML compute instance</strong> drop-down menu.  If there’s no existing compute instance, click on <strong>Create Azure ML compute instance</strong></p>
</li>
<li>
<p>Under <strong>Custom Application</strong>, select the <strong>New</strong> option</p>
</li>
<li>
<p>Under <strong>Environment</strong>, select <strong>Use customized environment</strong>.</p>
</li>
<li>
<p>Under <strong>Environment type</strong>, select “xyz”</p>
</li>
<li>
<p>Click on <strong>Create</strong></p>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="exercise-1-bring-your-own-data">Exercise 1: Bring your own data<a href="#exercise-1-bring-your-own-data" class="hash-link" aria-label="Direct link to Exercise 1: Bring your own data" title="Direct link to Exercise 1: Bring your own data">​</a></h2>
<p>Open AI and most LLM models are training from various publicly available data.  However, there are instances where we need to use our own data and narrow the actions and data search of our LLM prompts to focus only on the scope of our data or expand the data from LLM model to include our data as well.  To use your own data in a LLM, you need to convert you data into numeric values.  Each word mapping to a specific number (token).  Then you train a model to find similarities, collations, or word association, the model creates vector indexes to the word associations.   The good thing is the Prompt Flow service provide an easy-to-use process your to upload dataset and it generates model and the Vector indexes.</p>
<p>To upload custom data for this lab, you need to use the Contoso Dentist clinic data located in <em>data/contoso_dental.xls</em>.</p>
<ol>
<li>Click on the <strong>Vector index</strong> tab.</li>
<li>Click on the <strong>Create</strong> button.</li>
<li>Enter an index name in the <strong>New vector index name</strong></li>
<li>Select <strong>Local folders</strong> under the <strong>Data source type</strong> drop-down menu</li>
<li>Click on the + icon for <strong>Click to Update Folders</strong>.  Then navigate to <strong>/data</strong> folder in the local directory.</li>
<li>Select the <strong>data</strong> folder.  Confirm that the blade displays the dental_office.xls file</li>
<li>Select <strong>Faiss Index</strong> for the <strong>Vector store</strong>.</li>
<li>Click <strong>Next</strong></li>
<li>Select your OpenAI connection name from the <strong>choose connection</strong> drop-down menu</li>
<li>Click <strong>Next</strong></li>
<li>Select <strong>Compute instance</strong> option under the <strong>Select compute type</strong> drop-down menu</li>
<li>Select the name of your runtime under the <strong>Select Azure ML compute instance</strong></li>
<li>Click <strong>Next</strong></li>
<li>Review the selections and click on <strong>Create</strong></li>
<li>Use the <strong>Status</strong> section of the page, to monitor the Vectior index creation job status.</li>
</ol>
<p><img loading="lazy" src="/responsible-ai-hub/assets/images/vector-index-pipeline-64c6899aaf41410213b36bf8ba829396.png" width="975" height="296" class="img_ev3q"></p>
<ol start="16">
<li>Wait till all the job nodes complete successfully.</li>
</ol>
<p><img loading="lazy" src="/responsible-ai-hub/assets/images/vector-index-output-b5925ebb7221fd7992fbee7e5255646a.png" width="975" height="474" class="img_ev3q"></p>
<ol start="17">
<li>Azure Machine Learning automatically creates an example Flow for you.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="exercise-2--create-chat-flow">Exercise 2:  Create Chat Flow<a href="#exercise-2--create-chat-flow" class="hash-link" aria-label="Direct link to Exercise 2:  Create Chat Flow" title="Direct link to Exercise 2:  Create Chat Flow">​</a></h2>
<p>We will learn how to create a basic chat agent that interacts with prompts power by an OpenAI model.</p>
<ol>
<li>In Azure ML studio, click on Prompt Flow.</li>
<li>On the Prompt flow page, select the <strong>Flow</strong> tag.   Then click on <strong>Create</strong> button.
This displays a gallery of different types of flows and evaluation templates you can clone.</li>
<li>In this lab, under <strong>Chat Flow</strong>, click on the Create button.</li>
<li>Enter a <strong>Folder name</strong> on the Create a new file blade.</li>
<li>Press <strong>Create</strong>.</li>
</ol>
<p><em>Input Node</em></p>
<p>On flow page, Prompt generates the Input fields need for the chat input node.  The right side of the page displays a pipeline containing action nodes with logic needed to build the flow.</p>
<p>Add LLM model for the Chat prompt</p>
<ol>
<li>Under the <strong>Connection</strong> drop-down menu, select the name for OpenAI connection created earlier.</li>
<li>Make sure Chat is select for <strong>Api</strong></li>
<li>Select <strong>deployment_name</strong></li>
<li>Skip the <strong>Advanced</strong> and <strong>Function</strong> calling section.</li>
<li>The <strong>Prompt</strong> section is already prepopulated for you:</li>
</ol>
<ul>
<li>System: Contains a rule for the agent.  You can enter instructions on how to handle use inquiries.</li>
<li>Since the Chat flow keeps the context and dialogue of the conversation, the prompt loops through the chat history to display what the assistant and user entered.</li>
<li>At the end, the prompt creates a prompt for the user to enter a question.</li>
</ul>
<p><em>Output Node</em></p>
<p>If you scroll back to the Output section, you’ll see that the answer is linked to the Chat nodes output.</p>
<p>Lab1: Run the Chat</p>
<ol>
<li>To test the Chat flow, click on the <strong>Chat</strong> icon</li>
</ol>
<p><img loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAywAAABXCAYAAADmg8ECAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAHYcAAB2HAY/l8WUAACQhSURBVHhe7Z3dbyVHmcaR+Df2cv+L3DC52wtfWWg1N1hceBWkEVJGAllImQjWSsCbFUe7kzO7kBHseJiNGYGHZJxMMGhjCDgkzMkmciBjscRJFmcgnk0wiTiCSO/WWx9db1VXf52PPl/PT3o0p7q666urq9/ndPvMJ373u98RBEEQBEEQBEHQNOoT/X6fIGjexZM9tR2CoHaFaxFqUzrQWbkFQa0I69v4BMMCLYSwiEDQdAjXItSmeL4B0BZY38YnGBZoIYRFBIKmQ7gWoTYFwwLaBOvb+ATDAi2EsIhA0HQI1yLUpmBYQJtgfRufYFighRAWEQiaDuFahNoUDAtoE6xv4xMMC7QQwiICQdMhXItQm4JhAW2C9W18gmGBFkJYRCBoOoRrEWpTMCygTbC+jU8wLNBCCIsIBE2HcC1CbQqGBbQJ1rfxCYYFWghhEYGg6RCuRahNwbCANsH6Nj7BsEALISwiEDQdwrUItSkYFtAmWN/GJxgWaCGERQSCpkO4FqE2BcMC2gTr2/gEwwIthIZeRP5wQDe2dunxpJ6nnx9/lD4OgqBAo76hH1y5Sd0vPEXdx1+l/0vkQ4utURuWN76j5tsX1Xy79Dp9aLcB4IBhGZ9qG5bLly/T/fff30h8TKosCGpbwy4iv9z6T/q7fyrRt/bpXuI4CIJCjfaG/hHdfvwGdR5Q+vc3EvnQomu0huVjevWSnW/f/I3dBoAHhmV8qm1Y2ICktpdpkGPGrrdv0sVHLtLNtxN50Nj19s2LdPHm28m8cWpow3LNGJMv3fgl/fxloWefpmU2LP/2E3o7cVxKvUufpK99WunST5L5Xj+hq5/+DD3zTiqPxfmPUS+ZN5je2fmMadvadXonke+k+1DZ/nEoHJNh2sF97e68lcxrJm7TJ+nqK6m80Yj72aytr9JzD32Krj70eXr+t4m8r3DedXoj2N6ORntDP6YfXjAB5OWbx4n8Er1znbo81/V8qrrWRqxXHpvQ9TOg9FiVrTXTPd9Gx3v044ftfLv1nt1Wk9/foEt6vn2Wbv2KP3foNZs1bu4+91m69Ny7NjX9cHu/9o19m0rw/j794OH76drDagzjx1wu71v79IHdVEn/lE7txzwqr28/1gCGZXxqbFjc05MqyWOK9TbdvPgIPfKI0pXbYdpJb08dO3ndvmLbePFmOli9fSXsi9KV2z6fg/cwP2+kzD5X6LbY5rfLY5XisbL1yzqlwrITY1/UryE064Zl4+Xo1a+jn9DnrGF55sYztPcHkZdS5Y1fqm3D0nLQNpBG18bRGZbxa1DDcv2fP09P7twJ8j688wRdffQf6Mm5MCzvZIblew0NYzimMCylqmlYpnW+jY67mWHZPrCbavLaNz7pTYM2LzAsRdQzLA/S975+P+288me70XD3F1+m7258roFh6dPh5lk629mnE7vFc0L7HZW3eaj2qgcMy/g0kGGJ82I1NSw+oOa0DNpN/iQC3NpiU1BmWKSJ0E93vPmoDt5v0xW1/xVljGLTkTrWGChhbnTb1H7J9nHZcv947MejWTcshdKG5WnaPU4fn4lv/BVPL7wmYVhGWd44BMNSTyaA3H7iMXryK0/Q6yLv9eufomf+4+KcPGH5FX2XX8954Dl6vurLgkg8pv6pGAxLqWoalmmdb6PjDl238+2F2l/fG9iwXHMmB4allLpPWHa+1aFrF59XNtLxLu1//UG6dfWrzZ6wOGPS7YknLafU6xYZmWJgWManqXjCUmxYlETQzwH5xZs3TaDtgnBtAuwTARd8R8aAlQXKuTwXuLNc3XE7zD6+ncZI6DKaGJao3Mrg3R2fK6f4WDNGdrs+7mbSiJjjeSybGRY+zpRpx0z33ZzH5FMZeX5U3u2qPo9JbRiWvRd+Rq/+MX28Fgcp+pUAIxcsZa9hacmgKR9EcZDlj48Mhg4qXH68/TF6xtaTfHUpONYHx7I++ZpY/ttpt59vb9CvsuAsap8rwx9fPCayHeazMo5rts44wJJ9VH3pqfKlCZB9zbbrY0T9+hzGgZtsk/38SliXGbe3dNuC8bd976WOE2OW75toU1I2gHzpJXr+0b+n5+7Y7fdeoqc4oDy4PmeG5b/oIJmfkjkP7lyb8xPOq3BOK2Xngo/N7xcan3h+uO2uPJUfGJawLjknWXJe5q55VjaH/DZ97djyw/XF72f2ue7HQo+DGBtxvafqCDXd8210OMOyR2/YLdW8S7e+ZMeU9aUbdDdnWPbpmstnuWCd9+P9TYrooKPyxXGcTgX22etnpr7XAsMS1hUaGZmn6kmVnzBb0mCwMXNl677qrW6fG34sdJ4Ym9y+1YblRwev0K2Hv0z779vt/3uLvqsMzOErTQ0LI03LYGaFgWEZnyb8Nywm0G1iWMLXo9g4iP15XxFAJ8sNDEu0n8gLDIHafkUdHxoBayCyOm0ZUnI/lxb7VhkW7q9pW9RPpcJjZR2u/rgdWXnCeKXGPiFtWAJjx+ckTPt2Re225qWsz+NSG4blxrXv043SIFKJb/wyEIgD4CAw4ODEB0cyCGGZQCa9ry7X1aPLzAdCecXBkEoHgZovwwTQ/DkRhLNk/VWK2ucCrCCdlRX207fDjUeYFwaFYnxSdUZ9DQylzivoa1A2f1b1ir7LdsTnkNOmDfFxJu3qivuWNk5SLoC8S+/87CG6ev0l+lBtv/fSY+rzq/ThnTkxLG+9SJc5gPzHl+ndVH6JeExDo+HGN5zrbl85V7I8NY+uKgOTpQMj4hTPG3uu3X7qmCxPz0t/nuP5YuZBfN7j8jkt+qJMSeFcjPocp2U/6xmW6ZxvI+Pdl818W79N9+ymuhQ/YTFBuzQO/vUxzvss3fq92X73uY4yMD4dlJnBpsPv48xLVr4yIWE73L6mHb48a15yxiHeT7ZRHZPtH/ZLm5Corjgd7FvHsLxJdLh9lr73gjnurecepB/84l36YCDDwhijsrS0FD1tqQ8My/g09BMWmR9vl/lpRYYhFzRzwOvzg6cHSubb/jgQTxuO7LUoaVgiAxHUL/K4rCs3fRk67dqcK0OI89zTBVbQVhf8i3xZjmynUqrvycBf9jUzKpFxCLZLwyLaopQqX7dZ9KMsHee5bcl2j1ltGJZf3vl1ddDEN/4sKI0DDSMfSMkgSn524m0miIgDG5lXHWw4iWMSkoGaDODk50y161SK9y1Nh+NQ2g5hmvLjI/uTH1vZ1ywA3EkFoyx5fL6soP38OTj/xceVj3F67nj5ALJ/94e0/ZCq/95d2n/Cfvs9L4bljZ9TlwPIAX4hjMfUj58Y/5TZluctmldXd3yeTsfnJFUeb0vOpfI5YbaJa8MqmK/BHIsk6uVjZBtK08E1mNJ0z7eR8T8vmvk2wC+EFRoWfoohn6IwnG+3healQ7dUMC/T8kkHkwr2eVtmWAK4DGsaUu0oeIITlCfaGiP3i9tVlo7zcgjD8tc3v03XNm7RW/Rr+tH6V+nl9wmGZU41sicsMn84wxIGzT6vwLCIfY1sYC4Cd/+kwm6XhiV3vNvXBfPcpvjfKPgvMywuYNf1SjNWHrzngn1pRGx+8lhZp/js95ftjw1L2L6U4naVpVNtTG1rQ20YluZPWGRw4uWDDxmwpAIVv00HF/xtWCB7bGWw4ZSvIy43HUCb4Fnma3FwpI+rqDtuX2lajklFUC/G2o+pzQu2cZm+j5lkQKn7UtQP2aawfT7fHSvOuWhf6jjZ5rxhiQPuWCKA7H9AvSc+Rc/cuE7bjz5Nv+H8eTEsf3qf3vvD+/rb/GR+icLxE+OfNBPyHLrPfC7jf+Nzr5QqL9jmrx8jV4as0ym1TalsrmfXoZWtV1/bol2l6fiazGm659vI+MtH9McPPqK/2mQTSg1LLjjnpxtRPh8T/5swCtIkOMJt7umGkzAscTsKDIusO65Pmw0x38ZtWIjepBc2HqQf3VTG5Vuv0J/UlsEMC14Jm3ZNoWEpDpprP2XQcmXJoFwpNiwi2I5ljI463u6TpaVBqWtYlFLBfbr9ZlyKzVTRsdF4BvXbcUhty44dvWGReaz4HLalNgzLq3futPuERQQRuSBFqjLYcAqDoVQAUxZAF/VHB0xZnxOK21eaDsdBtiPXJj5OBHGyL+H+BUFgJhOIXr2UL8OoxnmS/VfjwfWG5yx/XPl4FwTHmWQAaV/NUeknf2jLmAvD8hG9+8qL9PSVF+lggP+4lce00LDE8zU6h+ZYdYydD1k6Nc8T5fn5GF8z8rwWzKWCudpT8/OZd6J5EdfNadvm+JooTZfUazTd8200fEz3Dl6mZ77zMr1x8rHdVp9Bn7Bk5kXtZ4736diYMKlgP3xKU/A6V6IdZcbhtW/wceJ4RcqEjN+wmFfBrqn0rQPzi2HNDQv+6H4WNOWvhIXKBbuJpxZSOqi/ckVJBM3SsOiAXdYfSh+v2pPVqYL9IG231TUscX91+angvaDM2AyEx5qyg/qi+nn8pOmpbVhEe2QbWKXp+Pzo9IwallH9x5FR4KODggbBuQwodNrtq4+LghunymDDievz+3H5Pkg2gVVxAJ06xqqq/ji/NJ0fk8I28XFurHUZYnx0OjxWjq2UD9xE3YVt4s+yrHDcjNQ+ayqg09/Ki23R+eN6g/aJMdFtSgXHmcIAst9/SaW/QD+9a/PnwbAc278nYD16m95L7VMiHtOkYbHnUJ6zeG7pc6OMQbaNTahM5+ZHXJebI9F5j+ZpPC+DeZAwI91LLL+/n7vieJuO80rTQX9Smu75NhJObvv59rX/pj/azXUpNCz2b0Wk+fAGgzGmIPzblTAdlKc/x3muPK4rznNp0w5vZkw6Mw6xoWHD9A2WNxb5dvv0OA0LvX+Lvvfwt+nQJpsZFvys8axo+v/oXij57TwH0/bpg5YM2G2AHBiSwLD4fbLjpVGIA+6UwSkwF1mebI/bZsvUwb2s25Zd+BRCtKfo2GD/uH4+PmhrbFjC8rIfOBB9bGRYWLq/tjxVxqz+Slj/Dwd0Y2uXHk/qefp53W94+cYfBZo6MOAbg1ZZEGuCX7dv7heDOIDJylGqHWw4ReW5wErLPGGQAbT5HLYpqzNoSxiI5xS3rzQdjokMJOXn7LgooMvapLaHvxIW9cPVoY8RbXHpwjbZz/z3Lq4sEQQ6ycDRKOwXi+dF2DcV9GXtE22aMY3uhv4OPd+5SZ1zN+najxv+p5FKPKZpw+LSbqyjecXS5z+/f1Zecg6Lc8fzKHWtaCMryy255vm4YC2J2pA6XhkaV+9oDcv0amSGRYXqL/yLmW9P7jX8TyMVxYaFsebASpoXRgfwkVkIfi0sLk/n2/LUccGvhAV5HbqWMz42j8vjfZ1x4M/BE5jY4DCyH5+la2ysxmFYRg3+48iZUG3Dcvny5ezpSV3xMamyvGLDMoMSwXwyH5oKYRGB2lEc+KYVBsuLJVyLQ4iNQ/SFh5cwM1Cm0RmWxYONQ2yePGxOpOkCDNa38am2YRmPxLf68ZOIGZB7xQqGZfqFRcRLf7uffQtmJb5ZHZfCJ0lWhcHXrKqGYSkNOudfuBYHlXlaknvaYyWfyEFeMCwDErwulqfczCwuWN/GpwkbFghqR1hEoHZUZljc6znVT2DmWbgW6yv35ULqiwX3utkCm+AywbDUJXwtjRW+7mVxr41Ff6APDFjfxicYFmghhEUEgqZDuBahNgXDAtoE69v4BMMCLYSwiEDQdAjXItSmYFhAm2B9G59gWKCFEBYRCJoO4VqE2hQMC2gTrG/jEwwLtBDCIgJB0yFci1CbgmEBbYL1bXyCYYEWQlhEIGg6hGsRalMwLKBNsL6NTzAs0EIIiwgETYdwLUJtCoYFtAnWt/EJhgVaCGERgaDpEK5FqE3BsIA2wfo2PsGwQAshLCIQNB3CtQi1KRgW0CZY38anT/DgQhAEQRAEzaNSwQ8EjUOp+QeNRp+wphAAAAAAAAAApg4YFgAAAAAAAMDUAsMCAAAAAAAAmFpgWAAAAAAAAABTCwwLAAAAAAAAYGqBYRkj9/Z+RN0vPkXdh1+kN+02AAAAAAAAQH1mz7Cc9qizuk1HNjlS+ge0tdmjE5scluPvP0udB25QZ/023bPb6nFE26urtKq0rTp6tL1Knd6pzRs3XPeYxncscHs71NrwAAAAAACAVlkgw3JKvY4xAGWc9C7ThcujMS2vf1OZFTYs3/yN3VKP016HVkVDYVjKgGEBAAAAAJhnYFgSsGlZH9q0fEyvXjKG5fKt9+y2erBhkQYFhqUMGBYAAAAAgHlmSMNig8Xetn59yb3CpCLsMM3wtk5P2QZPdSDO5ZtysrKcYRF1yKcR+ulEdowLvMNyuB1VsGnpDGVa3qMfP8yG5Sl66o7dVAMek7j98Til9nHb/VAYg+aP43Q6sJflbR+FhiWoKzp/cqw7vaNE+QmTKA2n/uzLz/az+/Sy8k25vj5ZDwwLAAAAAMA8MwLDogJIF2k6ExGkpWmIA00fGOcxZcsgVsXEPsh1GTrtylUB8rYPqnWw7Quo/YTFYUzLQRCk1+euNSzP0vMNXU/ZExYdtEvjII0gf846qMZPGYiOHKfIcDC6PDEoxqCIcxaNX9YuWa/CmIm8cYjLl307VUY321/OFXuOgz7H6azueF4BAAAAAIB5YjRPWLJgsTzNwbCPp31w7QJSrWTwLdDBrDQ6JUYkKGMww8Kvhg0WC9+h6/z3Kw/s0Rt2S11kUM94w5IKzrlfdpscG9X3Tq+n9pfpuCep8nibHF+Pb1dqLEU7JIFRKthHI+qNz3FpOtUHAAAAAAAwL7RqWKSBCMxLgjhoz4iDV0XOCDnzw8oymhkWbVa6Q7wS9pfX6MmBfiEs3/fQsIR9Z3z/vSE42o7/TfU9VV64LTCTSt6wyPPMFJkRsT0wLwzXJc6VqxeGBQAAAAAAWNo1LDp45UCTt4sANIEOlFPuosywsFmRAbEwSKbueoZlaLOi+TN9+MEp9W2qCeWGJQ7OQ6Ngjj3KXo3L0nrcYxLlifGNz4FvV2osU22z2Kc7Yb/i/cWcgGEBAAAAAACWlg2LCXq3t1OvJ0XooFQExSrt/4ZFBK8KZ1jiAJu3NzUsozErRB++/Ro9980X6aW3P7Jb6hMG9qYfLq37FJuyXFod7zrK4yXT0TiEY2TTdnxlve44l9ZjLerVaXeuc+dIzQNlmFjZtngfbrdLx3mlaRgWAAAAAIB5pnXDYoLNmgGm3pcDaJY9Jg5eFRxYm5jbBNXuFSM2RjIYN0GxylOBdhJV9uWR/B8sv6Ft/fcrSg/+VKWaUWZYGGMqrKRZ0fCYS2MWGg2XjvOzMQt+JcyUZfLYaObb5Y4LfiWs4BwF50JhTI4tQ50rPGEBAAAAAAAxQxqWAeBgMxdkzxsf0RvfeZb+9dxTdPm7vx3otbDZQxqdPN5UAgAAAAAAUJ/WDQsC1/kk9QQlYyFMKgAAADA/3Pubv50KAcC0Z1jc61hwK3NB8DoXK2lI3OtmeGULAAAAmCVS5mESAoBp/5UwAAAAAAAw1aTMwyQEAAPDAgAAAAAAAlLmYRICgIFhAQAAAAAAASnzMAkBwMCwAAAAAACAgEmYh0nUCWYDGBYAAAAAABAwCfMwiTrBbADDAgAAAAAAAiZhHiZRJ5gNYFgAAAAAAEDAJMzDJOoEswEMCwAAAAAACJiEeZhEnWA2gGEBAAAAAAABkzAPk6izFv0j2t04R8tn7qP7zizT2maPTmwWaAcYFgAAAECigpO97hqdXVLByX1naPncOu0c9W0mAIvBJMxDszoPqHsfX6OxuipnlJzQ7toKre8dkVkFTulwe42WNvZtGrQBDAsAAADg6KsgaGWFOvvHKhjp0+HWOVrpHiAwAQtHM/NwRNsry3Rh51CF88wh7WWf69OsToZNizMo8vMw9Olgc4N2jm3ycIuWc+bklPYunKdd+5ilf7BJG7vugLoc0dbZlOGq0NktdeTwHO+u0ZlU+VpnaK1xf8bLBAzLqCbU5DjZPU/n3SwFdNC9j9T9fLE52aXz53fxiBiAmaZPvc5Z6vQ4NOnT0fYarXT27XV9Sr1uh/aaRmAAzCjNzAPHdudpfWOFllY6tH9yTPvZZ7tLDZrVyYzDsCiOd2htac2YloMu3ZcIclzs01f5Z892qdd4bRikvaPqY1U5IxzLEQHDMgAwLCETMyxsEqZlLsGwADAHqPvT8hYdqk+nexfozIr5rC5w2u+o4GvpDK237lj4num/yQWj4oR2z2Ncy2hmHnxsd9LbpPNLS/ppy/HBVva5zpXTrE5GxpQjji+PtlWMkXr6EGtjwC8yBmnvqProyuF/uQ/xGI6qntExA4aleFEpNA7shtUJKAqi+bhh3nFsbFhse7ymaZHk8R3OcDQ1LGb85XjUPBc8jtIUzLRhsYtE8STVC+VEjCAAi8rpHq1n17ExKee29mh3nf89pKMma/+g635uXeO1Yh4Da3Pv0WMTLHR2bcw0rjW+pmHJzuMYzoFd511f4/We763ZOEzgZtDMPESxnf4jdWXyz21S7/iI9tznijFsVicj643aMCzq3J/dNF9ZFNOn/Y1lUsvDAAzS3lH10ZXD//Ici8fwlA42d+y26WB+DYs6Jh1AxienOQMZFrnY6AVw8PpHy2QMixw/bWDqBPv6vM6TYeE5mp7b7kY1gXsUAAvMEW2tbNB+9rK6MS1r2+aPbQ83V+sHJoOu+wtmWII1To9RtE2NR3csna9pWDTjOQcnu7v+PMfzI7jfDX+fHoRm5iEd25mnLWdpfdc9bTGfix5INKtTcbRN54JxOjugechzvHM+e6J6etCjQ/lHLMc9ZcTMx5PdNVobaHKkx6ycQY6pSZ//as+Vrz6Hf7QzcebXsHR3k8eZY9QCOMQJH9qwBH3i8VCfd81CnZUbffOSC/B1/2y+vljNgubTDlv+gSgvy+c8uy13XH2GNSymHXw+EouyvXn/jPss2qr3cTd2e5PTihoSfEMVnPPEuDTpRAy3pdH4mT7vpuaSLWs3Gld93rO+hHM7nBOun/L8hvsDAGLsH9iv71HqT031e+pNrvGSdZ/XpfwaqPJ+JtYyJbNPYq2K2lG2Npi6Dvz9IVgH8wRlifabNeZArKm+nnR/TD35PEe83tt+pnYV+PpZzdZ02TczJrI+Pt6Vm+pPUdsS9Wbnp/ieFraM4XL8dm6rbEOcTiP7EPetYGwS7XF1NTMPYftDjv0TloqnLc3qPKW99bNqfH1kra9TdQ2P4sVNnmtumE57XVpZ2SRd1fEera+cU8bI1qvqXB7IJZWNWREntL+x3fAY1eSqP7DfOaRed4XOdru0cd8GdTdXaHmjp7+omRbm2LCoGnI3DHvRngwySTz1Fg5ByY3LtElNmFw75SIXLnpcv1+MTF6c9u2z5YsbnF7ws8LDsgdBXtR1yI+fPx+6b6KwYF8eR3mj1gut6ItO+7miy5L7B8fH4xKPeUOsycjqqsT12ffd4W7wwbhy2+V+0U0mnBNMdF4TNyUAgMOalewP7I9pt7tB23s96vX2aGt9lZZVsNLoj2rL1v14LZP75q7VirWqYm3Q671YG8L1PyJql1uLGLPG+HqD9bWkP7KMkGiNistIMNSaHpWfWzNVfravHkO5nnJZMi2J6+Wi/BjrerKCTTo5HmLMNEF769yny9b8srGJy/bztJl54DLL7jH8oxUrdN8at+FUBd1L9nNIozoPtxJfInD7l6nyTa5CTumox9d9j7YvhGNuTMsanZdmhel1aLW7p4/pHfKvC9alaswUJz21/vj//+Xc+lbla3V5qupx+cpYKgPI1/nShd3kFzeTZIyGxVwQoYurUmpA/cUTU33hcxvCBclvr5gkCrOgpdpZrDoLkS43WDjC/sULnEaUEeeXp/Plqx3EQhYvVsWYG18zpcrl9slxCm6g3LZgkY7On1ycohtz2JdEv4Py8vnFN1aBrjPfz1LlFlTGz8Gw3nC76Uv6HPl8blY0Z+KxCvoOAPAkzMqFZVrbVsHH7hZtbm7TXqMgxFK57vu1S17L+XWtbK2qXhv8vpbc2uBIlFVy3wnbWdKfQqL6ovHKkx8HU0adNT01TvLYmDgvVbcjkSfHhj9n450q194nUn3nMbH5leOZO691x4abKO7Jor2NzIOuQ85bgQq6N5WJWNnYpcOj/exz6r82ql8n/6zwshqXfCH8lGX5wqBPWVTQvrmprvtN6qypdUAMmvk1sBVaWb5A8hd/+dWxsxe6+pjNHf7rj7qUjBmjzsXakvuJdaZPx/sdWllaK5iLRbh63HyL65TtOFGG7UjMo+lhvp+wKPw+8cXbpA0hhfUWIRYdrWBR4baE/UuWLxYRzpeLW3k6X37Yfx6XOjeXYurdnDy6fXI8goPFeQoWekW8IHN+dB59W9LnOMyvMe51idtaiWhfdG5dG3xb09eA3Dc854p4zlkFQw3AwlNgVrL/gGEIStd9eX1Ha1VuXStbq6rXBq4nWNcK1ypzLwjaLNqdW2Oidmf9qb0WRveeeH3PEY2Tpd6anhqneFvcf5mXL9uTypNtFfWUjY2eL74c7pcc7zido3TNLxsbncja5cdzFIbllA53N1SAf542VRDsPydHQFO3Tm1KEv31GuYpi0X8/yvGrKj+qUT/aJvWMtPCxmmVtgf6j1FSY+bgn1hfSv4qYX9/g5Y6TV7XcvXwvzw2qc9F7Zge5t6wZPWlttlUUwrrLSKoO4bbkl9IcvuLMuL88nS+fLWDWDTNIh1X1wS5wNWhcvxUXzk/tx+PgVzsuR/ReSy7eZm+um3pcW90XiW1b9KOcA6adqe28af0OZLjHs8BPVbxAQCAgOMd+f+s8OsQK6MxK0zVNchrBufH++XWtbK1qnpt4M/Bula4VhXfa5ncGhOtYa4f9dfRuO35foak8uuu6alxkvvH+fFYlLUtkRePsRobbkfV2PjzVlBmdL8LKJ1vZWOjU7a/vJ+vo655MITHhk9V/OfUUxVJvTq5vRV/XJ98Xawph7SpjAl7huO93eCV0P7RLu2ye+E/+j+3M+DrU9GYBRzQ5hn5AyCC/j5tnNksOC5Fqh7eBsNSQdOBiRcOT+HFH124vAiw4/abhjs59RdkS8OFxCxM8eLp01y/LK88bSdlljZlhQuVrKs58uZYh+rxU20+39UKiuVxrG1YzOdg/+D4/Lg3Pq+SwiCgiGgOctuC82Ta75L6nMr9o77Hc8CUP9x5BWCe4W9MV7M/sB/hkxVH6brP8Nqr1rluav2X61r5WlW1NvA6EqxrJWuVLqssL7fGxO3M9ydXf0b+3mP6kh8P9ythw6zpcd/CuqJj9RjKsvJleziv7B7LqH1y9zS1327Q+aDOeNzi9ucx7UhPuXz75dgwOt1VxkoUUM88OLgO7p98qnJc66mKpE6d+glD5R/W5/8gfxCOd87RcuHTDLVurA3zfzMV/U/3PI7jNiySqvzpYEYMS+pk2gs42G4v1vhGkVughzs58YVeSemNi9uSWAj14hX1y6L7LTaUp2359lfItOK2cPt4e+liWIwMrOtQZ/z0jSlXqJ8LOkuPUXge47bocly/c3OgfAFvRG6OVRHPQe5b2J64L/q8ur5E/Y7ngCaaQ4OeXwDmkdO9dVrd4vc4jmlnbYnW5Evpo6DSsNjrNnFdunXLrEfVa1XZ2sBlBetaxVoVrJlKrgv5NSZew+yxUdm5+jPMep4bInc/ckqUl86rHid5bO5XwmS92lzIsvJle2xe2T1WoeuOtgd9yZUfxT4l5yyjcM2vHht3rGxiHfPg4TpW1dziJyn8RYC6rmo+VZFU16nKPVfzp4uHfMrSV8efW+nQZmdFPIm19I/0E9mVjQ3xetioOKIjNWijeyVMjdruBVqScyMQ/0rYiNe/MTADhmX6yF3oU03ZQjsaeNFNrM9DMY4yx0pjwwIAmCgq4Ni5sExnzqzQxt5kbtazdS8ZNQWGZSopu4/Wu8fO3D1NUW0eJPxzu+u0deAC7GM6aP5zVjXqVPNm7Uwi6E7rTOKXyOpgzErXvgbWp6PdDVpdVgZsdZVWV1doWT41Ot4ZgWnheeTbrZ/qqLhiNH90Px/AsAwADEvIyBfiWQz+YVgAAI2Y/XvhcIgnCNMcyWdPXoYwLCO8P3D84YLaTGO691Sbh9EziTqT9E/oJPcIo0+np6dK+Wcb/aODRk+SajOSnzWeDyZgWEC7jN+wjA53A5uV9gIAQHPcq0Cz9o07SFF2j53te9okzMMk6gSzAQwLAAAAAAAImIR5mESdYDaAYQEAAAAAAAEp8zAJAcDAsAAAAAAAgICUeZiEAGBgWAAAAAAAQEDKPExCADAwLAAAAAAAICBlHiYhABgYFgAAAAAAEJAyD5MQAAwMCwAAAAAAAGBKIfp/Yl40dGgh4pkAAAAASUVORK5CYII=" width="812" height="87" class="img_ev3q"></p>
<ol start="2">
<li>Enter “what is prompt engineering” in the text box and click submit icon.</li>
</ol>
<p><img loading="lazy" src="/responsible-ai-hub/assets/images/what-is-prompt-69330b010bbff362400f77959f021ee9.png" width="693" height="295" class="img_ev3q"></p>
<ol start="3">
<li>Next, enter “My molar tooth is aching so bad.  What could be the cause?”</li>
<li>Finally, enter “What is the address of your dental clinic?”</li>
</ol>
<p><img loading="lazy" src="/responsible-ai-hub/assets/images/dental-address-b3c425e1568a166bdc53e0552a863469.png" width="1293" height="326" class="img_ev3q"></p>
<p>As you can see the Chat is not able to answer specific questions about a business or dental clinic.   This makes some of the answers not reliable or available.  In the next exercise, you learn how to bring your custom data into the chat to provide response that are relevant to your data.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="exercise-3-create-chat-agent-to-use-custom-data">Exercise 3: Create Chat agent to use custom data.<a href="#exercise-3-create-chat-agent-to-use-custom-data" class="hash-link" aria-label="Direct link to Exercise 3: Create Chat agent to use custom data." title="Direct link to Exercise 3: Create Chat agent to use custom data.">​</a></h2>
<p>In the precise exercise you create a vector index and train to search for your vector embeddings.  In the exercise, you’ll be expanding the Chat pipeline logic to take the user question and convert to numeric embeddings.  Then we’ll use the numeric embedding to search the numeric vector.  Next, we’ll use the prompt to set rules with restrictions and how to display the data to the user.</p>
<p>We&#x27;ll be using the following tools:</p>
<ul>
<li><strong>Embedding</strong>: converts text to number tokens.  Store to token in vector arrays based on then relation to each other.</li>
<li><strong>Vector index lookup</strong>: Takes user input question and queries the vector index with the closest answers to the question.</li>
<li><strong>Prompt</strong>: enters user to add rules on the response show be sent to user</li>
<li><strong>LLM</strong>: provides the LLM prompt or LLM model response to user</li>
</ul>
<ol>
<li>Open the Flow page, by clicking <strong>Prompt Flow</strong>.</li>
<li>Click you the Chat flow you created in Exercise 1.</li>
<li>On the Flow toolbar, click on <strong>More tools</strong>.  Then select the <strong>Embedding tool</strong>.</li>
</ol>
<p><img loading="lazy" src="/responsible-ai-hub/assets/images/flow-tools-480fe56a56c497cfde43713c215a0380.png" width="358" height="427" class="img_ev3q"></p>
<ol start="4">
<li>Enter <strong>Name</strong> for the node (e.g. embed_question).</li>
<li>Click the <strong>Add</strong> button.</li>
<li>Select the <strong>AzureOpenAIconnection</strong> name you created earlier.</li>
<li>Select <strong>Text-embedding-ada-002</strong> deployment name you created earlier</li>
<li>For <strong>Input</strong>, select <code>*${inputs.question}*</code>.  This should create a node under the input node.</li>
</ol>
<p><img loading="lazy" src="/responsible-ai-hub/assets/images/search-vector-88b150e9f60372e4d3085f7752d00b11.png" width="1280" height="327" class="img_ev3q"></p>
<ol start="9">
<li>Click the Save button</li>
<li>On the Flow toolbar, click on <strong>More tools</strong>.  Then select the Vector Index Lookup tool.  This will generate a new <strong>Vector Index Lookup</strong> section at the bottom of the flow.</li>
<li>Enter <strong>Name</strong> for the node (e.g. search_vector_index).</li>
<li>Click the <strong>Add</strong> button</li>
<li>For <strong>Path</strong>, copy and paste the Datastore URI you retrieve earlier for the vector index.</li>
<li>Select the embedding output as the <strong>query</strong> field (e.g. <code>*${embed_question.output}*)</code>.</li>
<li>Leave default value for <strong>top_k</strong>.</li>
</ol>
<p><img loading="lazy" src="/responsible-ai-hub/assets/images/search-vector-88b150e9f60372e4d3085f7752d00b11.png" width="1280" height="327" class="img_ev3q"></p>
<ol start="16">
<li>Click the <strong>Save</strong> button</li>
<li>On the Flow toolbar, click on <strong>Prompt</strong> tool. This will generate a new Prompt section at the bottom of the flow.</li>
<li>Enter a <strong>Name</strong> for the node (e.g. generate_prompt).  Then click the <strong>Add</strong> button.</li>
<li>Copy the following text in the Prompt textbox:</li>
</ol>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">system:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">You are an AI system designed to answer questions. When presented with a scenario, you must reply with accuracy to inquirers&#x27; inquiries.  If there is ever a situation where you are unsure of the potential answers, simply respond with &quot;I don&#x27;t know.  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">context: {{contexts}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% for item in chat_history %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{{item.inputs.question}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assistant:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{{item.outputs.answer}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% endfor %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{{question}}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="20">
<li>Click the <strong>Validate and parse input</strong> button to generate the input field for the prompt.</li>
<li>Select the <code>${Search_Vector_Index.output}</code> for <strong>chat_history</strong></li>
<li>For <strong>contexts</strong>, select <code>${inputs.chat_history}</code>.</li>
<li>Select <code>${inputs.question}</code> for the <strong>question</strong> field.</li>
</ol>
<p><img loading="lazy" src="/responsible-ai-hub/assets/images/output_prompt-dc4d757017594755a8a91c48523b4613.png" width="975" height="549" class="img_ev3q"></p>
<ol start="24">
<li>Click on the <strong>Save</strong> button</li>
<li>Click on the <strong>chat</strong> node and drag it below the <strong>generate_prompt</strong> node</li>
</ol>
<p><img loading="lazy" src="/responsible-ai-hub/assets/images/chat-node-a559006b1f5cfc83dbb2123788e5a588.png" width="350" height="424" class="img_ev3q"></p>
<ol start="26">
<li>Under the <strong>Flow</strong> pane, scroll up to the <strong>chat</strong> section</li>
</ol>
<p><img loading="lazy" src="/responsible-ai-hub/assets/images/chat-node-input-c3a7a45f477e3c2827043d487d1c8376.png" width="975" height="363" class="img_ev3q"></p>
<ol start="27">
<li>Copy and paste the following text in the Prompt textbox.  This specifies the output to display to the user:</li>
</ol>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{{prompt_response}}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="28">
<li>Click on the Validate and parse input button to regenerate a new input field. Prompt Flow will generate the text metadata you specified in the Prompt textbox.</li>
<li>In the Prompt_response value, select <code>${generate_prompt.output}</code>.</li>
<li>Under the Flow pane, scroll up to the output section.</li>
<li>Replace the answer to <code>${chat.output}</code></li>
<li>Click on the Save button</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="exercise-4-test-chat-with-your-own-data">Exercise 4: Test Chat with your own data<a href="#exercise-4-test-chat-with-your-own-data" class="hash-link" aria-label="Direct link to Exercise 4: Test Chat with your own data" title="Direct link to Exercise 4: Test Chat with your own data">​</a></h2>
<p>Now that you have updated the prompt flow logic to you use your own data and process the output, let’s see if the Chat will generate more relevant information pertaining to our Contoso dental data.  First let clear the chat history, so the question is not base not the prior responses from our OpenAI model.</p>
<ol>
<li>
<p>Click on the edit icon for the chat history field on the Inputs flow section.  This will open an Edit text window.</p>
</li>
<li>
<p>Select all the text with the open and close brackets “[ ]”</p>
</li>
<li>
<p>Click on the Chat button to test the new flow</p>
</li>
<li>
<p>Enter the following question:</p>
</li>
</ol>
<p>what is your dental clinic address?</p>
<ol start="5">
<li>You should get the following response:</li>
</ol>
<p><img loading="lazy" src="/responsible-ai-hub/assets/images/dental-clinic-address-d7b4b709e72b85fc4b3935535ccc6165.png" width="949" height="316" class="img_ev3q"></p>
<ol start="6">
<li>Next, enter the following question:</li>
</ol>
<p>What is the clinic&#x27;s phone number?</p>
<ol start="7">
<li>You should get the following response:</li>
</ol>
<p><img loading="lazy" src="/responsible-ai-hub/assets/images/dental-clinic-phone-fef1f5954a93fda0318f3322a430fa26.png" width="949" height="314" class="img_ev3q"></p>
<ol start="8">
<li>Finally, enter the following what questions:</li>
</ol>
<p>My tooth is aching really bad.  What could be the cause?</p>
<ol start="9">
<li>You should get the following response:</li>
</ol>
<p><img loading="lazy" src="/responsible-ai-hub/assets/images/toothache-ebac0648e6e3b80f596721f875f30a7f.png" width="907" height="422" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="exercise-5--handle-groundedness--hallucinations">Exercise 5:  Handle Groundedness &amp; Hallucinations<a href="#exercise-5--handle-groundedness--hallucinations" class="hash-link" aria-label="Direct link to Exercise 5:  Handle Groundedness &amp; Hallucinations" title="Direct link to Exercise 5:  Handle Groundedness &amp; Hallucinations">​</a></h2>
<p>Always an LLM model may be eager to provide the user with a response.  It’s important to make sure that the model is not providing response to questions that are out of scope with subject domain of your data.  Another issue is the response may provide information that is not factual and, in some cases, even provide reference to the answer that appears legitimate.  This is a risk, because the information provided to the user can have negative or harmful consequences.</p>
<p>Grounding test</p>
<ol>
<li>
<p>On generate_prompt section of the Flow pane, click on Generate variants button.</p>
</li>
<li>
<p>Select Connection for your Azure OpenAI</p>
</li>
<li>
<p>Next, select the Deployment name.</p>
</li>
<li>
<p>Click Submit button.  These will generate a Variant_1 prompt section.</p>
</li>
<li>
<p>In the prompt textbox, copy and paste the following text:</p>
</li>
</ol>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">System: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">As an AI Assistant Prompt Engineer, I need you to generate a response to the user&#x27;s question.  Please cite your sources.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">context: {{contexts}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% for item in chat_history %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{{item.inputs.question}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assistant:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{{item.outputs.answer}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% endfor %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{{question}}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="6">
<li>Click the Save button</li>
<li>Now, enter the following question:
Which supplements are good for teeth?</li>
<li>As you can see, our chat produces a response that is factual button not in our Contoso dental data.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="exercise-6--evaluate-your-flow">Exercise 6:  Evaluate your Flow<a href="#exercise-6--evaluate-your-flow" class="hash-link" aria-label="Direct link to Exercise 6:  Evaluate your Flow" title="Direct link to Exercise 6:  Evaluate your Flow">​</a></h2>
<p>You can unit test your Flow.  However, Prompt flow provides a gallery of sample evaluation flows your can use to test you Flow in bulk.  For example, classification accuracy, QnA Groundedness, QnA Relevant, QnA Similarity, QnA F1 Score etc.  This enables you to test how well your LLM is performing.  In addition, you have the ability to examine which of your variant prompts are performing better.   In this example, we’ll use the QnA Groundedness evaluation template to test our flow.</p>
<ol>
<li>Click on the <strong>Evaluate</strong> on the top right-side of the screen.</li>
</ol>
<p><img loading="lazy" src="/responsible-ai-hub/assets/images/evaluate-aede03a9caf52891e4663a930f336b76.png" width="975" height="101" class="img_ev3q"></p>
<ol start="2">
<li>On the Basic settings page, select the <strong>Use default variant for all nodes</strong> radio button.</li>
<li>Click the <strong>Next</strong> button</li>
<li>On the Batch run settings page, click on <strong>Add new data</strong> link for the <strong>Data</strong> field.</li>
<li>Enter <strong>Name</strong> on the Add new data pane (e.g. Contoso-Dental)</li>
<li><strong>Browse</strong> to the workshop repo directory and select the <strong>contoso-dental.csv</strong> file.</li>
<li>Click on the <strong>Add</strong> button.   A preview of the top 5 rows of the data should be displayed at the bottom of the page.</li>
<li>Under Input mapping, enter the open and close brackets <strong>[]</strong> for the value of <strong>chat_history</strong>.</li>
<li>Click in the Value textbox for the <strong>question</strong> field and enter <code>${data.question}</code>.</li>
</ol>
<p><img loading="lazy" src="/responsible-ai-hub/assets/images/evaluate-input-flow-1308009d35933c4050b93212a44d7446.png" width="975" height="523" class="img_ev3q"></p>
<ol start="10">
<li>Click the <strong>Next</strong> button.</li>
<li>On the <strong>Select evaluation</strong> page, select the checkbox for the <strong>QnA Groundedness Evaluation</strong>.</li>
</ol>
<p><img loading="lazy" src="/responsible-ai-hub/assets/images/evaluation-gallery-0f7ded3f4413d56306bd078147000e21.png" width="1475" height="807" class="img_ev3q"></p>
<ol start="12">
<li>Click the <strong>Next</strong> button.</li>
<li>Click on the right arrow <strong>“&gt;”</strong> to expand the <strong>QnA Groundedness Evaluation</strong> settings.</li>
</ol>
<p><img loading="lazy" src="/responsible-ai-hub/assets/images/evaluate-qna-fields-cb1170858c26305ea944cc434a6f9625.png" width="975" height="456" class="img_ev3q"></p>
<ol start="14">
<li>Click on the Data Source textbox and enter <code>${data.question}</code> for the question field.</li>
<li>Enter <code>${run.inputs.contexts}</code> for the context field.</li>
<li>Enter <code>${run.outputs.answer}</code> for the answer field.</li>
<li>On the right-hand side of the page, scroll down to the bottom of the page.</li>
<li>Select your AzureOpenAI connection name for the Connection.</li>
<li>For Deployment name / Model, select your AzureOpenAI deployment name.</li>
</ol>
<p><img loading="lazy" src="/responsible-ai-hub/assets/images/evaluate-connection-9b5fae9aa674bd383e1a47a47613052a.png" width="973" height="441" class="img_ev3q"></p>
<ol start="20">
<li>Click the Next button.</li>
<li>Finally, click on the Submit button.</li>
<li>Click on View run list to monitor the run progress.</li>
</ol>
<p><img loading="lazy" src="/responsible-ai-hub/assets/images/start-evaluate-61f66a3b2560fe8d78e923720a0dd77b.png" width="1242" height="440" class="img_ev3q"></p>
<ol start="23">
<li>Click the Refresh button to update the run status. The run should take ~15 minutes.</li>
<li>Click on the Display name of the run to view the run results.</li>
<li>Click on View outputs.  Then select the run name from the Append related results option.</li>
<li>The results will include a column for gpt_groundedness score.</li>
</ol>
<p><img loading="lazy" src="/responsible-ai-hub/assets/images/evaluate-results-9ea135abf486f1a6ce3ea3eba2301302.png" width="1815" height="842" class="img_ev3q"></p>
<ol start="27">
<li>The score will range from 1 to 5, where 1 is the worst and 5 is the best performance.</li>
</ol></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/responsible-ai-hub/docs/prompt-flow-overview"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Prompt Flow Overview</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/responsible-ai-hub/docs/evaluate-chatbot"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Lab# 2: Evaluate chatbot</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites:</a></li><li><a href="#launch-github-code-spaces-to-create-azure-resources" class="table-of-contents__link toc-highlight">Launch GitHub code spaces to create Azure resources</a></li><li><a href="#enable-prompt-flow-and-access-connection-data" class="table-of-contents__link toc-highlight">Enable Prompt Flow and Access Connection data</a></li><li><a href="#add-flow-connections" class="table-of-contents__link toc-highlight">Add Flow connections</a></li><li><a href="#create-a-runtime" class="table-of-contents__link toc-highlight">Create a Runtime</a></li><li><a href="#exercise-1-bring-your-own-data" class="table-of-contents__link toc-highlight">Exercise 1: Bring your own data</a></li><li><a href="#exercise-2--create-chat-flow" class="table-of-contents__link toc-highlight">Exercise 2:  Create Chat Flow</a></li><li><a href="#exercise-3-create-chat-agent-to-use-custom-data" class="table-of-contents__link toc-highlight">Exercise 3: Create Chat agent to use custom data.</a></li><li><a href="#exercise-4-test-chat-with-your-own-data" class="table-of-contents__link toc-highlight">Exercise 4: Test Chat with your own data</a></li><li><a href="#exercise-5--handle-groundedness--hallucinations" class="table-of-contents__link toc-highlight">Exercise 5:  Handle Groundedness &amp; Hallucinations</a></li><li><a href="#exercise-6--evaluate-your-flow" class="table-of-contents__link toc-highlight">Exercise 6:  Evaluate your Flow</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__links text--center"><div class="footer__links"><a href="https://aka.ms/rai-hub/collection" target="_blank" rel="noopener noreferrer" class="footer__link-item">Responsible AI Collection</a><span class="footer__link-separator">·</span><a href="https://responsibleaitoolbox.ai/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Responsible AI Toolbox</a><span class="footer__link-separator">·</span><a href="https://learn.microsoft.com/ai/" target="_blank" rel="noopener noreferrer" class="footer__link-item">AI Developer Hub</a><span class="footer__link-separator">·</span><a href="https://discord.gg/yrTeVQwpWm" target="_blank" rel="noopener noreferrer" class="footer__link-item">Azure AI Discord</a><span class="footer__link-separator">·</span><a href="https://privacy.microsoft.com/privacystatement" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy Statement </a><span class="footer__link-separator">·</span><a href="https://microsoft.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">© 2023 Microsoft</a></div></div></div></footer></div>
</body>
</html>